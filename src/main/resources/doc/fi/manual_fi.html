<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
        "http://www.w3.org/TR/REC-html40/loose.dtd">
<html lang="en">
<head>
    <title>Titokoneen käyttöohje</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style type="text/css">
        .virhekuvaus {
            font-weight: bold;
        }

        .virhetoipuminen {
            padding-bottom: 1em;
        }
    </style>
</head>
<body>
<h1>Titokoneen käyttöohje</h1>
<!-- P {font-family:"Verdana", serif}-->


<!-- OLLI: Laitoin yläotsikoille (h2) valmiiksi a name -ankkurit,
     jotta #-linkit toimivat. Lisäile ankkureita ja tunnuksia
     loogiseksi katsomallasi nimeämisperusteella sitä mukaa kun tulee
     tarpeen viitata aiempiin/tuleviin aliotsikoihin (kuten
     esimerkiksi esimerkkivirhetilanteessa, jonka kirjailin
     loppupäähän). Tämän kommentin voi poistaa lukemisen jälkeen. -->

<h2>Sisällysluettelo</h2>

<ol>
    <li><a href="#yleiskuva">Yleiskuva</a></li>
    <li><a href="#asennus"> Titokoneen asennusohjeet</a></li>
    <li><a href="#toiminnot">Järjestelmän toiminnot</a></li>
    <li><a href="#konekieli">TTK-91-konekieli</a></li>
    <li><a href="#laajentaminen">Järjestelmän hienosäätö ja laajentaminen</a></li>
    <li><a href="#pulmanpoisto">Virhetilanteita</a></li>
    <!-- <li><a href="hakemisto">Asiahakemisto</a></li> --> <!-- jos jaksaa kerätä-->
</ol>

<h2><a name="yleiskuva">1. Yleiskuva</a></h2> <!-- niinku täh? mikätääon? -->

<p>
    Titokone on konekielisimulaattori, jonka tarkoituksena on näyttää, kuinka symbolisen
    konekielen suoritus etenee yksinkertaisella prosessorilla.

</p>

<table>
    <tr>

        <td>
            <a href="Lahdekoodinakyma.html" name="gui">
                <img src="img/screen0.jpg" title="Järjestelmän perusnäkymä"
                     alt="Järjestelmän perusnäkymä, jossa eri osiot numeroitu">
            </a>
        </td>

        <td>
            <ol>
                <li> Valikot</li>
                <br>
                <li> Koodi-ikkuna</li>
                <br>
                <li> Tilatiedot</li>
                <br>
                <li> Näyttö</li>
                <br>
                <li> Näppäimistösyötteet</li>
                <br>
                <li> Symbolitaulu</li>
                <br>
                <li> Rekisterit</li>
                <br>
                <li> Kommentti-ikkuna</li>
            </ol>


        </td>

    </tr>
</table>
<br>


<!-- Kuvaillaan käyttöliittymän osat numeroittain: 1. valikot: höpöhöpö jne. -->
<!-- Kunkin selityksestä viitteitä kohtiin, joissa sitä käytetään. -->


<!-- TITOKONEEN ASENNUS -->


<h2><a name="asennus">2 Titokoneen asennusohjeet</a></h3>
<br>

<p> Jos olet jo asentanut Titokoneen, siirry suoraan Titokoneen <a href="#toiminnot">toimintoihin</a>.</p>

<table cellspacing="10">
    <tr>
        <td>
            <img src="img/0.jpg" title="" alt="">
        </td>
        <td>
            <h3> 2.1 Javan hakeminen ja asennus</h3>
        </td>
    </tr>
</table>

<p>
    Titokone on Javalla toteutettu TTK-91-konekielisimulaattori. Tarvitset
    sitä käyttääksesi Javan virtuaalikoneen (vähintään version 1.4.2)
    koneellesi. Javan virtuaalikoneen Sunin implementaation voi ladata
    osoitteesta <a href="http://java.sun.com">http://java.sun.com</a>. Seuraa siellä annettuja
    asennusohjeita.
</p>

<p>
    Sunin Java-sivuilta on joskus hieman hankala löytää hakemaansa. Jos
    haluat asentaa pelkän virtuaalikoneen, haluat "JRE"-paketin, jos taas
    haluat myös kehitysympäristön tehdäksesi omia Java-ohjelmiasi (tai
    esimerkiksi uusia käännöksiä Titokoneeseen), haluat todennäköisesti
    "SDK"-pakkauksen. Tätä kirjoitettaessa J2SE:n versiot 1.4.2, sekä
    SDK:nä että JRE:nä (2 on alustan järjestysnumero, versionumero on
    erikseen), voi ladata sivulta
    <a href="http://java.sun.com/j2se/1.4.2/download.html">http://java.sun.com/j2se/1.4.2/download.html</a>.
</p>

<p>
    Huomaa, että Helsingin yliopiston tietojenkäsittelytieteen laitoksella
    on jo valmiiksi asennettuna Java SDK 1.4.2 (tai uudempi versio), joten
    Javan asennus on vain tarpeen jos haluat käyttää Titokonetta
    esimerkiksi kotikoneellasi.
</p>


<table cellspacing=10>
    <tr>
        <td>
            <img src="img/0.jpg" title="" alt="">
        </td>
        <td>
            <h3> 2.2 Titokoneen hakeminen </h3>
        </td>
    </tr>
</table>


<p>
    Titokoneen voi hakea Tietokoneen toiminta -kurssin kotisivun
    kautta. Sivut ovat tällä hetkellä osoitteessa
    <a href="http://www.cs.helsinki.fi/teemu.kerola/tito/">http://www.cs.helsinki.fi/teemu.kerola/tito/</a>. Voit joko
    hakea
    suoraan JAR-paketin, joka sisältää Titokoneen (titokone.jar), tai
    ZIP-tiedoston, joka sisältää JAR-paketin, hieman ohjeita ja
    apuskriptejä.
</p>


<table cellspacing=10>
    <tr>
        <td>
            <img src="img/0.jpg" title="" alt="">
        </td>
        <td>
            <h3> 2.3 Titokoneen asennus </h3>
        </td>
    </tr>
</table>

<p>
<h4>
    Pika-asennus (Windows, Linux, jne)
</h4>
</p>

<p>
    Jos JAR-paketit ovat sinulle jo tuttuja, riittää jos haet
    titokone.jar-tiedoston. (JAR on pakettitiedostomuoto; jos
    Windowsissasi on päiväntasainen versio WinZipistä, se osannee myös
    avata paketin jos näin haluat. Linuxissa komento jar avaa paketin,
    ks. alla.) Sen kummempaa asennusta ei tarvita, voit ajaa jar-tiedoston
    suoraan. Esimerkiksi Windowsissa sinun tarvitsee vain suorittaa
    komento
<pre>java.exe -jar titokone.jar</pre>

hakemistossa, johon tallensit titokone.jar -paketin. Vastaavastaa ohjelman.
Tähän mennessä sinulla tulisi olla Java asennettuna ja suorituspolullasi.
</p>

<h4>Melko nopea asennus Windowsissa</h4>

<p>
    Hae titokone.zip ja avaa paketti haluamaasi kohdehakemistoon. Paketti
    luo avautuessaan alihakemiston titokone. Vaihda sitten tähän
    alihakemistoon ja tuplaklikkaa titokone-nimistä BAT-tiedostoa (MS-DOS
    Batch). Titokone.bat erottuu titokone.jar-tiedostosta ikoninsa
    perusteella; titokone.jar näyttää yleensä keltaiselta joltakin
    ruuvipuristimessa, kun taas titokone.bat näyttää enemmänkin
    hammasrattaalta ohjelmaikkunassa. Titokone.sh, käynnistyskripti
    Linux-koneita varten, on todennäköisesti Windowsin tuntematon
    tiedostotyyppi.
</p>

<p>
    Jos BAT-tiedostot eivät enää toimi Windowsin versiossa MEGASUPERHYPER
    (testasimme niitä Windows XP:hen asti), lienee siellä kuitenkin vielä
    tuki komennon 'java.exe -jar C:\polku\hakemistoon\titokone\titokone.jar'
    ajamiseksi käynnistysvalikon kautta. Korvaa C:\polku\hakemistoon\titokone
    oikealla polulla, jolta titokone.jar löytyy.
</p>

<h4> Melko nopea asennus Linuxissa</h4>

<p>
    Hae titokone.zip ja avaa se (esim. gunzip titokone.zip) valitsemassasi
    kohdehakemistossa. (Paketti luo avautuessaan alihakemiston
    'titokone'.) Ohjelman ajaaksesi avaa terminaali-ikkuna, vaihda
    avautuneesta paketista luotuun titokone-hakemistoon ja aja komento
</p>
<pre>java -jar titokone.jar</pre>
<p>
    Jos kirjoittaminen on rasittavaa, ZIP-paketissa on myös
    titokone.sh-aloitusskripti. Voit uudelleennimetä skriptin haluamaasi
    muotoon (esim. tk), jonka jälkeen riittää pelkkä komento ./tk (tai,
    jos et nimeä tiedostoa uudelleen, ./titokone.sh). Skripti ei vaihda
    työhakemistoa, joten joko sinun tulee säilyttää se samassa
    hakemistossa titokone.jar-paketin kanssa tai muokata sitä.
</p>

<h4>Jar-paketin avaaminen (lähinnä jatkokehittäjiä kiinnostavaa)</h4>

<p>
    Halutessasi voit avata jar-paketin:
</p>
<pre>
  Windowsissa: Paketti on varmaankin helpointa avata käyttämällä
               WinZipiä tai vastaavaa paketinkäsittelyohjelmaa.
	 
  Linuxissa: jar -xvf titokone.jar
</pre>
<p>
    Jar-paketti sisältää mm. lähdekooditiedostoja, esimerkiksi koska haluat lisätä
    uuden kielitiedoston (ks. mukana tuleva käyttöohjeen käännösten
    lisäysohjeet), huomaa että luokkatiedostot ovat osa Java-pakettia
    (tarkemmin ottaen kolmea pakettia).
    Käynnistääksesi muokatun ohjelman vaihda paketin juurihakemistoon
    (jossa 'fi'-alihakemisto on) ja aja seuraava komento:
</p>
<pre>
  Windowsissa: java.exe fi.helsinki.cs.titokone.Titokone
  
  Linuxissa: java fi.helsinki.cs.titokone.Titokone
</pre>
<p>
    Luokkien javadocit ovat hakemistossa javadoc/. Jotta voit kääntää
    java-tiedostoja (esimerkiksi lisätessäsi uuden kielen), tarvitset
    Javan SDK-pakkauksen, JRE ei tähän riitä.
</p>
<br>


<!-- JÄRJESTELMÄN TOIMINNOT -->


<h2><a name="toiminnot">3. Järjestelmän toiminnot</a></h2> <!-- mitä tällä voi tehdä? -->

<br>

<!-- OHJELMAN AVAAMINEN -->


<table cellspacing="10">
    <tr>
        <td align="center">
            <a name="avaa">
                <img src="img/1.jpg" title="Avaa kuvakkeesta"
                     alt="Kuva avaa-painikkeesta">
            </a>
        </td>

        <td>
            <h3>3.1 TTK-91-ohjelman avaaminen</h3>
        </td>

    </tr>
</table>

<br>

<table cellspacing="10">
    <tr>

        <td valign="top">

            <img src="img/Tiedostoavaa2.jpg" title="Avaa valikosta"
                 alt="Kuva avaa-painikkeesta">

        </td>

        <td valign="top">
            <p>
                Uuden tiedoston avaaminen tapahtuu painamalla <a href="1.html">avaa-pikakuvaketta</a> tai
                valitsemalla valikosta Tiedosto --> Avaa. Valinnan seurauksena
                avautuu <a href="#tiedosto">tiedostonäkymä</a>. Tiedoston voi avata myös näppäinyhdistelmällä CTRL+O.

            </p>
        </td>

    </tr>
</table>

<table cellspacing="10">
    <tr>

        <td valign="top">
            <a name="tiedosto">
                <img src="img/Tiedosto.jpg" title="Tiedostonäkymä"
                     alt="Tiedostonäkymä">
            </a>
        </td>
        <td valign="top">
            <p>
                Tiedostonäkymä näyttää nykyhakemiston tiedostot valitun päätteen mukaan.
                Näytettävät tiedostotyypit erotellaan päätteen mukaan: k91-pääte tarkoittaa lähdekooditiedostoa ja
                b91-pääte binääritiedostoa.
            </p>
            <ul>
                <li>
                    Avattaessa k91-päätteinen tiedosto, avautuu <a href="Lahdekoodinakyma.html">lähdekoodinäkymä</a>
                    ruudulle.
                    Lähdekooditiedosto on <a href="#kaanna">käännettävä</a> ennen kuin se voidaan <a href="#aja">suorittaa</a>.
                </li>
                <br>
                <li>
                    Avattaessa b91-päätteinen tiedosto, avautuu <a href="Suoritusnakyma.html">suoritusnäkymä</a>
                    ruudulle.
                    Binääritiedosto on valmiiksi konekielimuodossa, joten se voidaan <a href="#aja">suorittaa</a> ilman
                    kääntämistä.
                </li>
            </ul>
        </td>
    </tr>
</table>

<br>


<!-- LÄHDEKOODIN MUOKKAUS -->


<table cellspacing="3">
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <a name="koodinmuokkaus">
                <h3> 3.2 Lähdekoodin muokkaaminen </h3>
            </a>
        </td>
    </tr>
</table>


<p>Lähdekoodia on mahdollista muokata Titokoneessa seuraavasti: </p>
<ul>
    <li> Avataan k91-päätteinen tiedosto.</li>
    <p>joko</p>
    <li> Napsautetaan lähdekoodin riviä vasemmalla hiiren napilla, jolloin kursori ei ilmesty näkyviin, mutta riville
        voi kirjoittaa.
    </li>
    <p><img src="img/joko.jpg"></p>

    <p>tai</p>
    <li> Kaksoisnapsautetaan lähdekoodin riviä vasemmalla hiiren napilla, kursori ilmestyy riville.</li>
    <p><img src="img/tai.jpg"></p>
    <li> Kirjoitetaan riville muutokset.</li>
    <li> Vahvistetaan muutokset painamalla enteriä.</li>
    <li> Tehdyt muutokset tallettuvat alkuperäiseen tiedostoon.</li>
</ul>

<p>Suosittelemme kuitenkin tiedostojen muokkausta erillisessä
    ohjelmassa. Joskus on käynyt niinkin, että muokkauksen tulos on
    tallentunut toiseen, hetki sitten avattuun k91-tiedostoon. Ks. <a
            href="#paranoidi">vastaava virhetilannekuvaus</a>.


    <!-- Voi olla k91 tai b91, viittaa vastaaviin 2.x-lukuihin -->

    <br>


    <!-- OHJELMAN KÄÄNTÄMINEN-->


<table cellspacing="10">
    <tr>

        <td>
            <img src="img/2.jpg" title="Käännä"
                 alt="Kuva käännä-painikkeesta">
        </td>

        <td>
            <a name="kaanna">
                <h3>3.3 TTK-91-ohjelman kääntäminen</h3> <!-- Ja mahd. tekstin muokkaus -->
            </a>
        </td>

    </tr>
</table>

<table cellspacing="10">
    <tr>

        <td valign="top">
            <img src="img/Tiedostokaanna.jpg" title="Kääntäminen valikosta"
                 alt="Kuva käännä-painikkeesta">
        </td>

        <td valign="top">
            <p>
                Titokoneen käännös on kaksivaiheinen: ensin tehdään syntaksitarkistus ja luodaan symbolitaulu. Toisella
                kierroksella muodostetaan objektikoodi.
                Kääntäminen aloitetaan painamalla <a href="2.html">käännä-pikakuvaketta</a> tai valitsemalla valikosta
                Tiedosto --> Käännä.
                Kääntäminen toteutetaan <a href="#kaannosasetukset">käännösasetusten</a> mukaisesti,
                joko pysähdellen tai kerralla loppuun asti kääntäen. Ohjelman kääntäminen voidaan aloittaa myös
                näppäinyhdistelmällä CTRL-K.
            </p>
        </td>
    </tr>
</table>

<br>
<a name="kaantajantoiminnot">
    <b>
        Toiminnot kääntämisen aikana
    </b>
</a>

<table cellspacing="10">
    <tr>

        <td>
            <img src="img/4.jpg" title="Kelaa"
                 alt="Kuva kelaa-painikkeesta">
        </td>
        <td><p> Jatka askel eteenpäin: Riveittäin etenevää kääntämistä voi
            jatkaa tätä nappia tai rivinvaihtoa painamalla askel kerrallaan,
            edeten seuraavaan <a href="#kaannostapahtumat">tapahtumaan</a>
            asti. </p>
        </td>
    </tr>

    <tr>
        <td><img src="img/5.jpg" title="Fast forward"
                 alt="Kuva Fast forward -painikkeesta">
        </td>

        <td><p> Jatka loppuun asti: Halutessaan käyttäjä voi suorittaa
            käännöksen kerralla loppuun. Tämä ei muuta riveittäin käännöksen
            asetusta, vaan vain yliajaa sen tämän käännöksen osalta.</p>
        </td>
    </tr>

    <tr>
        <td><img src="img/6.jpg" title="STOP"
                 alt="Kuva stop-painikkeesta">
        </td>
        <td>
            <p> Pysäytä: käännös voidaan pysäyttää painamalla
                pysäytä-nappia. Näkymä pysyy siinä tilassa, missä se oli, kunnes
                Jatka-nappia painetaan.</p>
        </td>
    </tr>
</table>
<br>
<a name="kaannostapahtumat">
    <b> Käännöksen tapahtumatyypit </b>
</a>

<p> Tapahtumatyypeillä tarkoitetaan kääntäjän reagointia lähdekoodin
    sisältöön. Riviä kommentoidaan ja/tai riville pysähdytään <a
            href="#kaannosasetukset">asetusten</a> mukaisesti.</p>

<p> Ensimmäinen kierros:</p>
<ul>
    <li> Ei tapahtumaa: Jos rivi alkaa kommenttimerkillä (;), on tyhjä
        tai ei sisällä viittauksia symboleihin tai muistiviitteisiin
    </li>
    <li> Muuttujan määrittely: Jos rivillä määritellään uusi muuttuja, se lisätään symbolitauluun.</li>
    <li> Muuttujan käyttäminen: Jos rivin komennossa käytetään symbolia
        (tai muistiviitettä), symboli lisätään symbolitauluun jos se ei siellä vielä ole.
    </li>
    <li> Muistiviitteen löytyminen: Jos rivin alusta löytyy muistiviite, viite ja rivin numero lisätään symbolitauluun
    </li>
    <li> Käännöksen virhetilanne: käännös keskeytetään, virheestä ilmoitetaan käyttäjälle ja jatka-painikkeella
        palaudutaan lähdekoodinäkymään.
    </li>
    <li> Ensimmäisen käännösvaiheen valmistuminen: onnistuneen
        ensimmäisen kierroksen jälkeen muuttujille varataan tilaa,
        symbolitaulu päivitetään ja <a
                href="Kaannosnakyma.html">objektikoodinäkymä</a> tuodaan esiin.
        Toinen kierros voi alkaa.
    </li>
</ul>
<p> Toinen kierros: </p>
<ul>
    <li> Objektikoodin luonti: koodiriville tuodaan käskyn konekieliesitys ja käsky näytetään alapalkin tilatiedoissa.
    </li>
</ul>
<p> Käännöksen valmistuminen: </p>
<ul>
    <li>Ohjelma <a href="#lataaminen">ladataan</a> muistiin ja <a href="Suoritusnakyma.html">suoritusnäkymä</a> tuodaan
        esille.
    </li>
    <li> Käännöksen virhetilanne: käännös keskeytetään, virheestä ilmoitetaan käyttäjälle ja jatka-painikkeella
        palaudutaan lähdekoodinäkymään.
    </li>
    <li>Binääritiedosto <a href="#binaari">tallennetaan</a> automaattisesti samaan hakemistoon samalla nimellä muuten
        mutta eri päätteellä; pääte on b91.
    </li>
    </ol>
</ul>
<br>


<!-- KÄÄNNÖSASETUKSET-->


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <a name="kaannosasetukset">
                <h3>3.4 Käännösasetukset </h3>
            </a>
        </td>
    </tr>
</table>


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/Tiedostomuokkaakaannos.jpg" title="Käännösasetukset valikosta"
                 alt="Käännösasetukset valikosta">
        </td>
        <td valign="top">
            <p>
                Käännöksen aikaisia asetuksia voi muuttaa valitsemalla valikosta Asetukset --> Muokkaa käännösasetuksia.
            </p>
        </td>

    </tr>
    <tr>
        <td>

            <img src="img/Kaannosasetukset.jpg" title="Käännösasetukset"
                 alt="Käännösasetukset">

        </td>
        <td valign="top">
            <p>
                Käännösasetuksilla voidaan vaikuttaa käännöksen etenemistapaan ja kommentointiin.
            </p>
            <ul>
                <li>Jos 'Pysäytä kääntäminen kommentin ilmestyessä' on valittuna,
                    käännös etenee askelittain. Käännös jää odottamaan käyttäjältä
                    esimerkiksi Jatka-napin painallusta.
                </li>
                <li>Jos 'Näytä lisäkommentteja kääntämisen kulusta' on valittuna, rivin kääntämisestä ilmestyy
                    lisäkommentteja kommentti-ikkunaan.
                </li>
                <li> Asetusten muutokset tulevat voimaan painamalla
                    'aseta'-painiketta. Jos painat 'sulje'-painiketta tätä ennen,
                    muutokset peruuntuvat.
                </li>
            </ul>

        </td>

    </tr>
</table>

<br>


<!-- OHJELMAN LATAAMINEN-->


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <h3><a name="lataaminen">3.5 TTK-91-ohjelman lataaminen</a></h3>
        </td>
    </tr>
</table>


<p> Ohjelman lataaminen tapahtuu automaattisesti </p>
<ul>
    <li>K91-tiedoston <a href="#kaanna">käännöksen</a> valmistuessa.</li>
    <li>B91-tiedoston <a href="#avaa">avaamisen</a> yhteydessä</li>
    <li>Ohjelman suorituksen jälkeen; jos itseään muuttavaa ohjelmaa on suoritettu, koodialueen muutokset poistetaan.
    </li>
</ul>
<br>


<!-- SUORITUS-->


<table cellspacing="10">
    <tr>

        <td>
            <a name="aja">
                <img src="img/3.jpg" title="Suorita"
                     alt="Kuva suorita-painikkeesta">
        </td>
        </a>

        <td>
            <h3> 3.6 TTK-91-ohjelman suoritus</h3> <!-- Ja uudelleensuoritus -->
        </td>

    </tr>
</table>


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/Tiedostoaja.jpg" title="Aja valikosta"
                 alt="Ohjelman suoritus valikosta">
        </td>
        <td valign="top"> K91-tiedoston käännöksen tai b91-tiedoston avaamisen seurauksena ohjelma ladataan muistiin ja
            on valmis suoritettavaksi.<a href="Suoritusnakyma.html">
                Suoritusnäkymässä</a> koodi-ikkuna on jaettu kahteen osaan, koodi-
            ja data-alueeseen. On kuitenkin syytä huomioida, että Titokoneen
            muisti on todellisuudessa yhtenäinen alue; muistialueen jako kahteen
            osaan on toteutettu käytettävyyssyistä. Suoritus aloitetaan
            painamalla <a href="3.html">suorita-pikakuvaketta</a> tai
            valitsemalla valikosta Tiedosto --> Aja. Suoritus toteutetaan <a
                    href="#suoritusasetukset">suoritusasetusten</a> mukaisesti joko
            pysähdellen tai kerralla loppuun asti suorittaen, animoiden tai ei.
            Suoritus voidaan aloittaa myös näppäinyhdistelmällä CTRL-B.
        </td>

    </tr>
</table>
<br>

<b> Toiminnot suorituksen aikana </b>

<table cellspacing="10">
    <tr>

        <td>
            <img src="img/4.jpg" title="Jatka"
                 alt="Kuva jatka-painikkeesta">
        </td>
        <td><p> Jatka askelittain: ohjelman ajaminen voidaan tehdä rivi kerrallaan.</p>
        </td>
    </tr>

    <tr>
        <td><img src="img/5.jpg" title="Jatka loppuun"
                 alt="Kuva jatka loppuun -painikkeesta">
        </td>

        <td><p> Jatka: halutessaan käyttäjä voi suorittaa ohjelman loppuun pysähtelemättä.</p>
        </td>
    </tr>

    <tr>
        <td><img src="img/6.jpg" title="STOP"
                 alt="Kuva stop-painikkeesta">
        </td>
        <td>
            <p> Pysäytä: suoritus voidaan pysäyttää painamalla pysäytä-nappia.</p>
        </td>
    </tr>
</table>
<ul>
    <li> Jos suoritus keskeytyy virheeseen, lopputilanne
        näytetään vielä. Käyttäjä voi tällöin painaa jatka-nappia ladatakseen
        ohjelman uudelleen.
    </li>
</ul>
<br>


<!-- SUORITUSASETUSTEN MUUTTAMINEN -->


<table cellspacing="10">
    <tr>

        <td>
            <a name="suoritusasetukset">
                <img src="img/0.jpg" title=""
                     alt="">
            </a>
        </td>
        <td>
            <h3>3.7 Suoritusasetukset </h3>
        </td>
    </tr>
</table>


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/Suoritusvalikko.jpg" title="Valikko suorita"
                 alt="Suoritusasetukset valikosta">
        </td>
        <td valign="top">
            <p> Suoritusasetuksia pääsee vaihtamaan valitsemalla valikosta Asetukset --> Muuta suoritusasetuksia. </p>

        </td>
    </tr>
    <tr>
        <td rowspan=3>
            <img src="img/Suoritusasetukset.jpg" title="Suoritusasetukset"
                 alt="Suoritusasetukset">
        </td>
        <td>
            <p> Suoritusasetukset ovat melko pitkälti vastaavat <a href="#kaannosasetukset">käännösasetusten</a> kanssa;
                lisätoimintona on animointi.
            <ul>
                <li> Ohjelmakoodia voidaan suorittaa rivi kerrallaan</li>
                <li> Lisäkommentteja voidaan näyttää <a href="Suoritusnakyma.html">kommentti-ikkunassa(8)</a></li>
                <li> Animointi-ikkuna näyttäminen voidaan kytkeä päälle tai pois</li>
                <li> Kun animointi on päällä, riveittäin suoritus menee automaattisesti päälle.</li>
                <li> Asetusten muutokset tulevat voimaan painamalla 'aseta'-painiketta.</li>
            </ul>
        </td>
    </tr>
</table>

<p> Suoritusasetuksia on mahdollista muuttaa myös suoraan pikakuvakkeista:</p>
<table cellspacing="10">
    <tr>
        <td>
            <img src="img/7.jpg" title="Riveittäin suoritus"
                 alt="Riveittäin suoritus">
        </td>
        <td>
            <p> Riveittäin suorituksen kytkeminen päälle tai pois. </p>
        </td>
    </tr>
    <tr>
        <td>
            <img src="img/8.jpg" title="Suorituksen kommentointi"
                 alt="Suorituksen kommentointi">
        </td>
        <td>
            <p> Suorituksen lisäkommentoinnin kytkeminen päälle tai pois. </p>
        </td>

    </tr>
    <tr>
        <td>
            <img src="img/9.jpg" title="Animointi"
                 alt="Animointi">
        </td>
        <td>
            <p> Animointi-ikkunan näyttämisen kytkeminen päälle tai pois. </p>
        </td>
    </tr>
</table>
<br>


<!-- Animointi -->


<table cellspacing="10">
    <tr>

        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <h3>3.8 Animointi</h3>
        </td>
    </tr>
</table>


<table>
    <tr>
        <td>
            <img src="img/Animointi.jpg" title="Kuva animaattorista"
                 alt="Kuva animaattorista">
        </td>
        <td valign=top>
            <ul>
                <li> Animaattori esittää konekielisen käskyn suorituksen prosessorilla.</li>
                <li> Ruudun yläreunassa näkyy symbolinen käskymuoto kun käsky on tulkittu IR:ssä.</li>
                <li> Ruudun alareunassa näkyvät kommentit suorituksen etenemisestä.</li>
                <li> Kontrollia ja menevää dataa kuvaa punainen pallo, joka etenee väylää pitkin.</li>
                <li> SVC-komentoja ei animoida.</li>
                <li> Luettaessa laitteelta MAR:iin ladataan koko käsky, ei pelkkää muistiviitettä; esitystapa eroaa
                    hieman oikeiden koneiden toiminnasta.
                </li>
            </ul>
        </td>
    </tr>
</table>
<br>


<!-- STDIN, STDOUT -->


<table>
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <h3>3.9 STDIN- ja STDOUT-tiedostojen valinta </h3>
        </td>
    </tr>
</table>


<table>
    <tr>
        <td>
            <img src="img/Asetastd.jpg" title="STDIN ja STDOUT"
                 alt="STDIN- ja STDOUT-tiedostojen valinta">
        </td>
        <td valign=top>
            <ul>
                <li> STDIN ja STDOUT -oletustiedostoina ovat tiedostot 'stdin' ja 'stdout' käyttäjän työhakemistossa.
                </li>
                <li> Tiedostoja voidaan vaihtaa valitsemalla valikosta <b>Asetukset --> Aseta tiedostojärjestelmä</b>
                </li>
                <li> Tiedostot voidaan määrittää myös lähdekoodissa <a href=#stdindef>def-valekäskyllä</a>.</li>
                <li> Lisätietoa oletustiedostojen määrittelystä löytyy kohdasta
                    <a href=#asetustiedostot>asetustiedostot</a>.
                </li>
            </ul>
        </td>


    </tr>
</table>
<br>


<!-- MUISTIN TYHJENTÄMINEN -->


<table cellspacing="10">
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <h3> 3.10 Muistin tyhjentäminen</h3>
        </td>
    </tr>
</table>

<!-- Viimeistään täällä maininta muistin pysymisestä samana ellei sitä
nollata. -->
<table>
    <tr>

        <td>
            <img src="img/Tyhjennamuisti.jpg" title="Muistin tyhjentäminen"
                 alt="Muistin tyhjentäminen">
        </td>
        <td valign="top">
            <p> Titokoneen muistin voi tyhjentää valikosta valitsemalla <b>Tiedosto --> Tyhjennä muisti</b>. Muistin
                tyhjentämisen lisäksi toiminnolla voidaan tyhjentää lähdekoodinäkymä.
                Jos toimintoa käytetään käännös- tai ajovaiheessa, kyseinen toiminto keskeytyy ja ruudulle palautetaan
                <a href="Avausnakyma.html">avausnäkymä</a>, jossa rekisterit, symbolitaulu ja koodinäkymä on
                tyhjennetty. Muistin tyhjennys voidaan tehdä myös näppäinyhdistelmällä CTRL-E.</p>

            <p>Ellei muistia tyhjennetä tai sen kokoa muuteta, aiempien ohjelmien
                jäljet jäävät muistiin. Niiden symboliset muodot piilotetaan selkeyden
                vuoksi. Jos ohjelma lukee muistipaikasta tai rekisteristä ennen kuin
                tallentaa sinne jotakin, tulos voi olla jotakin muuta kuin 0.</p>

        </td>

    </tr>
</table>
<br>

<table>
    <tr>
        <td>
            <img src="img/0.jpg" title=""
                 alt="">
        </td>
        <td>
            <h3>3.11 Muistin koon vaihtaminen</h3>
        </td>
    </tr>
</table>


<table>
    <tr>
        <td>
            <img src="img/Muisti.jpg" title="Muistin koon muuttaminen"
                 alt="Muistin koon vaihtaminen valikosta">
        </td>
        <td valign="top">
            <p> Titokoneen muistin kokoa on mahdollista muuttaa valitsemalla valikosta <b>Asetukset --> Aseta muistin
                koko</b>.
                Muistin kokovaihtoehtoja on kahdeksan erilaista 512 rivistä 65536 riviin asti. Kun uusi muistin koko
                asetetaan, koodinäkymä tyhjennetään
                ja näkyville palautetaan <a href="Avausnakyma.html">avausnäkymä</a>.</p>
            </p>
            <p>Kun muistin koko ylittää 32768 riviä, loppupään riveihin ei voida viitata suoraan koodista, sillä
                vakio-osaan ei mahdu 32768:aa suurempia lukuja. Sen sijaan esimerkiksi riville
                32768+500 voidaan viitata seuraavalla koodinpätkällä:</p>
<pre>
   LOAD R1, =32768 ; Ladataan maksimivakio rekisteriin
   LOAD R2, 500(R1) ; Ladataan rivin 32768+500 sisältö R2:een.
</pre>
            <p>Arvon voi myös tallentaa EQUn tai DC:n avulla, koska niiden
                maksimiarvot ovat suuremmat. Rekisterit ovat kaikki 32-bittisiä
                muistirivien tapaan, vaikka komentojen osoiteosaan ei 16 bittiä
                enempää mahdukaan.</p>

        </td>
    </tr>
</table>
<br>


<!-- KIELEN VAIHTAMINEN -->


<table>
    <tr>
        <td>
            <a name="kielenvaihto">
                <img src="img/0.jpg" title=""
                     alt="">
            </a>
        </td>
        <td>
            <h3>3.12 Käyttöliittymän kielen vaihtaminen</h3>
        </td>
    </tr>
</table>

<table>
    <tr>

        <td>
            <img src="img/Asetakieli.jpg" title="Kieliasetusten vaihtaminen"
                 alt="Kieliasetukset">
        </td>
        <td valign="top">
            <p>Titokoneen käyttöliittymässä on mahdollista vaihtaa kieliasetuksia. Kieli valitaan valikosta <b>Asetukset
                --> Aseta kieli</b>. Oletuskielinä ovat suomi ja englanti. Kielen voi vaihtaa suoraan lennosta, lähes
                riippumatta käyttöliittymän muista toiminnoista. Jos käyttäjä on määritellyt oman kielitiedoston, hän
                voi joko valita sen luettelosta lisättyään sen kieliasetustiedostoon tai valita sen erillisestä
                tiedostosta. Kieliasetustiedostoon lisätyt kielet tulevat näkyville 'Aseta kieli' -valikon alle.
                Erillisessä tiedostossa
                olevan kielitiedoston avaaminen onnistuu valikon kohdasta 'Valitse tiedostosta...'. Jos kielitiedosto on
                oikeaa muotoa, kieli vaihtuu välittömästi. Jos tietyn tekstin käännösvastine puuttuu kielitiedostosta,
                käytetään käyttöliittymässä oletuskieltä, englantia, kyseisen tekstin kohdalla. Lisäohjeita uuden kielen
                lisäämiseen löytyy kohdasta <a href="#kielenlisays">Uuden kielen tukeminen</a>.

            </p>
        </td>
    </tr>
</table>
<br>

<!-- Jne, sopivassa järjestyksessä. -->

<h2><a name="konekieli">4. TTK-91-konekieli</a></h2>
<!-- Tässä voi miettiä, haluaako toistaa tekstitiedoston speksin vähän 
     siistimmässä formaatissa vaiko vain. Mietin, nyt päädyin tähän...
-->
<br>

<h3>

    4.1 Yhteenveto TTK-91-käskyistä
</h3>
<br>

<pre>
+--------------------------------------------------------------------+
|    Käskykoodi    ¦  Rj ¦ M ¦  Ri ¦      osoiteosa ADDR             |
|    8 bittiä      ¦  3  ¦ 2 ¦  3  ¦         16 bittiä               |
+--------------------------------------------------------------------+
31               24 23           16 15                               0
</pre>

<p>
    Symbolisessa konekielessä käskyt esitetään muodossa
</p>

<pre>VIITE  OPER Rj,M ADDR(Ri)

missä  OPER    käskyn symbolinen nimi
       Rj      ensimmäinen operandi (rekisteri R0..R7)
       M       osoitusmoodi:
               =   välitön operandi
                   suora osoitus (tyhjä, ei siis merkitä)
               @   epäsuora osoitus
       ADDR    osoiteosa (muistiosoite tai vakio)
       Ri      mahdollinen indeksirekisteri (rekisteri R0..R7)
</pre>
<p>
    Jos jollakin käskyn osalla ei ole merkitystä, sen voi jättää merkitsemättä. Käskyn eteen voi laittaa viitteeksi
    symbolisen osoitteen, jonka
    tulee sisältää vähintään yksi muu kuin numeromerkki. Kelvollisia merkkejä A-Ö, 0-9 ja _. Vain 8 ensimmäistä merkkiä
    on merkitseviä.
</p>

<p>
    Lähes kaikille käskyille on käytettävissä seuraavat muodot:
</p>
<pre>
   OPER Rj,ADDR        suora muistiosoitus
   OPER Rj,=ADDR       välitön operandi 
   OPER Rj,@ADDR       epäsuora muistiosoitus
   OPER Rj,ADDR(Ri)    indeksoitu osoitus
   OPER Rj,=ADDR(Ri)   indeksoitu välitön osoitus
   OPER Rj,@ADDR(Ri)   indeksoitu epäsuora muistiosoitus
   OPER Rj,Ri          suora rekisteriosoitus
</pre>
<p>
    Poikkeuksia ovat:
</p>
<pre>
    STORE           jälkimmäinen operandi on aina kohdeosoite,
                    ei voi olla rekisteri, tai vakio.
    POP             Jälkimmäisen operandin tulee aina olla rekisteri
    HYPPYKÄSKYT     jälkimmäinen operandi on aina kohdeosoite,
                    ei voi olla vakio
                    tilarekisteriä tutkivissa käskyissä on ensimmäinen
                    operandi merkityksetön
    NOP             operandeilla ei merkitystä
</pre>


<br>

<h3>
    4.2 TTK-91 symbolisen konekielen käskyt
</h3>

<p>
    Tiedonsiirtokäskyt:
</p>

<pre>
LOAD   vie jälkimmäisen operandin arvon rekisterin Rj arvoksi.
STORE  talleta rekisterissä Rj oleva  kokonaisluku jälkimmäisen operan-
       din arvoksi.
IN     lukee jälkimmäisenä operandina kerrotulta laitteelta kokonaislu-
       vun rekisteriin Rj (näppäimistöltä esim IN R1,=KBD)
OUT    tulostaa rekisterissä Rj olevan kokonaisluvun jälkimmäisenä
       operandina kerrotulle laitteelle (näytölle esim. OUT R1,=CRT)
</pre>
<p>
    Aritmeettiset ja loogiset käskyt:
</p>

<pre>
ADD    (add) lisää rekisterissä Rj olevaan lukuun  jälkimmäisen operan-
       din arvon.
SUB    (subtract) vähennä rekisterissä Rj olevasta luvusta  jälkimmäisen
       operandin arvon.
MUL    (multiply) kerro rekisterissä Rj oleva luku  jälkimmäisen operan-
       din arvolla.
DIV    (divide) jaa rekisterissä Rj oleva luku jälkimmäisen operandin
       arvolla. Jakolaskussa vain kokonaisosalla on merkitystä.
MOD    (modulo) jaa rekisterissä Rj oleva luku  jälkimmäisen operandin
       arvolla. Jakolaskussa vain jakojäännösosalla on merkitystä.

AND    (boolean AND) looginen JA-operaatio Rj:n ja jälkimmäisen
       operandin arvon välillä.
OR     (boolean OR) looginen TAI-operaatio Rj:n ja jälkimmäisen
       operandin arvon välillä.
XOR    (boolean XOR) looginen poissulkeva TAI-operaatio Rj:n ja
       jälkimmäisen operandin arvon välillä.
SHL    (shift left) siirrä rekisterin Rj bittejä vasemmalle toisen
       operandin ilmoittama määrä. Täytä oikeaa päätä 0-biteillä.
SHR    (shift right) kuten SHL, mutta siirrä oikealle.
SHRA   (arithmetic shift right) kuten SHR, mutta säilyttäen etumerkin
       (täytä vasenta päätä etumerkkibitillä).

COMP   (compare) vertaa ensimmäisen operandin arvoa toisen operandin
       arvoon ja aseta vertailun tulos tilarekisterin bitteihin SR
       L=pienempi, E=yhtäsuuri, G=suurempi.
</pre>
<p>
    Haarautumiskäskyt:
</p>

<pre>
JUMP   (unconditional jump) ehdoton hyppy toisen operandin ilmaisemaan
       kohdeosoitteeseen.

JNEG   (jump if negative) jos Rj < 0, niin hyppää jälkimmäisenä operan-
       dina olevaan osoitteeseen, muuten jatka seuraavasta käskystä.
JZER   (jump if zero)         jos Rj = 0
JPOS   (jump if positive)     jos Rj > 0
JNNEG  (jump if not negative) jos Rj >= 0
JNZER  (jump if not zero)     jos Rj <> 0
JNPOS  (jump if not positive) jos Rj <= 0

JLES   (jump if less) jos tilarekisterin SR bitti L asetettu, niin
       hyppää jälkimmäisenä operandina olevaan osoitteeseen, muuten
       jatka seuraavasta käskystä (käyttö COMP-käskyn yhteydessä).
JEQU   (jump if equal)         jos bitti E asetettu
JGRE   (jump if greater)       jos bitti G asetettu
JNLES  (jump if not less)      jos bitti E tai G asetettu
JNEQU  (jump if not equal)     jos bitti L tai G asetettu
JNGRE  (jump if not greater)   jos bitti L tai E asetettu
</pre>

<p>
    Pinokäskyt:
</p>

<p>
    Käskyn ensimmäinen operandi rekisteri Rj osoittaa pinon huipulle pinon
    päällimmäiseen alkioon. Pino-osoittimena käytetään tavallisesti rekisteriä SP (eli R6).
</p>

<pre>
PUSH   Kasvata pino-osoittimen Rj arvoa yhdellä ja vie jälkimmäinen
       operandi pinon päällimmäiseksi alkioksi.

POP    Poista pinosta päällimmäinen alkio ja vie se jälkimmäisenä
       operandina kerrottuun rekisteriin (HUOM: aina rekisteri).
       Vähennä pino-osoittimen Rj arvoa yhdellä.

PUSHR  Vie pinoon rekisterit R0, R1, R2, R3, R4, R5 ja R6 (SP) tässä
       järjestyksessä. Ennen kunkin rekisterin vientiä kasvata pino-
       osoittimen Rj arvoa yhdellä. 

POPR   Nouda pinosta arvot rekistereihin R6 (SP), R5, R4, R3, R2, R1 ja 
       R0 tässä järjestyksessä. Jokaisella noudolla hae ensin arvo
       pino-osoittimen Rj osoittamasta kohdasta kyseiseen rekisteriin 
       ja sen jälkeen vähennä pino-osoittimen Rj arvoa yhdellä.
</pre>

<p>
    Aliohjelmakäskyt:
</p>

<pre>
CALL   (call procedure) aliohjelmakutsu, eli kontrollin siirto toisen
       operandin ilmoittamaan osoitteeseen. Tallettaa paluuosoitteen
       pinoon, jonka huipulle osoittaa Rj.
EXIT   palaa aliohjelmasta kutsua seuraavaan käskyyn. Paluuosoite löytyy
       pinosta, jonka huipulle osoittaa Rj. Jälkimmäisenä operandina
       pinossa välitettyjen parametrien lukumäärä.
</pre>

<p>
    Systeemikutsut:
</p>

<pre>
SVC    (supervisor call) käyttöjärjestelmän palvelurutiinin kutsu.
       (systeemikutsu). Ensimmäisenä operandi pinon huippu Rj ja toisena
       operandina palvelun numero. Palvelurutiinikutsut ovat erikoisia
       kutsuja ennalta määrättyihin aliohjelmiin. Rutiinien koodi on
       näkymättömissä, koodialueen "ulkopuolella".

       Palvelunumeroita:

       HALT : Lopettaa ohjelman suorituksen.
       TIME : Antaa kellonajan. Pinossa välitettävä osoitteet, jonne
              halutaan tunnit, minuutit, sekunnit (HUOM: järjestys!).
       DATE : Antaa päiväyksen. Pinossa välitettävä osoitteet, jonne
              halutaan vuosi, kuukausi ja päivä. (HUOM: järjestys!).
       READ : Lukee kokonaisluvun. Pinossa välitettävä osoite, jonne
              luku halutaan luettavan.
       WRITE: Kirjoittaa kokonaisluvun. Pinossa välitettävä tulostettava
              arvo.
</pre>

<p>
    Muita:
</p>

<pre>
NOP    (no operation) ei toimintaa
</pre>
<br>

<h3>
    4.3 TTK-91-konekielen käskykoodit
</h3>

<pre>
   Käsky     Binääri   Desimaali Heksadesimaali

   NOP       0000 0000     0        00            

   STORE     0000 0001     1        01
   LOAD      0000 0010     2        02
   IN        0000 0011     3        03
   OUT       0000 0100     4        04

   ADD       0001 0001    17        11
   SUB       0001 0010    18        12
   MUL       0001 0011    19        13
   DIV       0001 0100    20        14
   MOD       0001 0101    21        15

   AND       0001 0110    22        16
   OR        0001 0111    23        17
   XOR       0001 1000    24        18
   SHL       0001 1001    25        19
   SHR       0001 1010    26        1A
   SHRA      0001 1011    27        1B

   COMP      0001 1111    31        1F

   JUMP      0010 0000    32        20
   JNEG      0010 0001    33        21
   JZER      0010 0010    34        22
   JPOS      0010 0011    35        23
   JNNEG     0010 0100    36        24
   JNZER     0010 0101    37        25
   JNPOS     0010 0110    38        26

   JLES      0010 0111    39        27
   JEQU      0010 1000    40        28
   JGRE      0010 1001    41        29
   JNLES     0010 1010    42        2A
   JNEQU     0010 1011    43        2B
   JNGRE     0010 1100    44        2C

   CALL      0011 0001    49        31
   EXIT      0011 0010    50        32
   PUSH      0011 0011    51        33
   POP       0011 0100    52        34
   PUSHR     0011 0101    53        35
   POPR      0011 0110    54        36

   SVC       0111 0000   112        70
</pre>
<br>

<h3>
    4.4 TTK-91-koneen ennalta määrätyt symbolit
</h3>

<p>
    Näitä symboleja voi käyttää TTK-91-ohjelmassa niitä erikseen
    määrittelemättä.
</p>

<pre>
Symboli         Arvo
--------------------
CRT             0
KBD             1
STDIN           6
STDOUT          7
HALT            11
READ            12
WRITE           13
TIME            14
DATE            15
</pre>

<br>

<h3>
    4.5 Kääntäjän ohjauskäskyt (valekäskyt)
</h3>

<p>
    Kääntäjän ohjauskäskyt antavat ohjeita symbolisen konekielen kääntäjälle. Ne EIVÄT ole varsinaisia symbolisen
    konekielen käskyjä.
</p>
<pre>
tunnus EQU arvo
</pre>
<p>
    Samaistuskäsky EQU määrittelee symboliselle tunnukselle kokonaislukuar-
    von. Tunnusta voi käyttää käskyn ADDR -kentässä, jolloin se käsitellään
    kuten vastaavaan paikkaan kirjoitettu "arvo".
</p>
<pre>
tunnus DC arvo
</pre>
<p>
    Muistinvarauskäsky DC (data constant) varaa yhden muistisanan vakiota
    varten, samaistaa varatun muistipaikan osoitteen ja symbolisen osoitteen
    "tunnus" sekä asettaa varatun muistipaikan sisällöksi luvun "arvo".
    Tunnusta voi käyttää käskyn ADDR-kentässä kuten muistiosoitetta.
</p>

<pre>
tunnus DS koko
</pre>
<p>
    Muistinvarauskäsky DS (data segment) varaa muistialueen, jonka koko on
    "koko" (sanoina) ja samaistaa varatun muistialueen alkuosoitteen ja
    symbolisen osoitteen "tunnus". Käytetään globaalien muuttujien tilanvaraukseen. Tunnusta voi käyttää käskyn ADDR
    -kentässä kuten muistiosoitetta.
</p>

<pre>
asetus DEF merkkijono
</pre>

<a name="stdindef">
    <p>
        DEF muuttaa TTK-91-koneen tiedostojärjestelmän simulointiasetuksia.
        Merkkijonon 'merkkijono' tulee olla absoluuttinen tiedostopolku.
    </p>
</a>

<p>
    Esimerkkejä:
</p>
<pre>
  STDIN DEF /home/myuser/ttk91/stdin
  STDOUT DEF C:\mydir\stdout
</pre>
<p>
    Muutettavat asetukset:
</p>

<pre>
  STDIN   Stdin-datan lähdetiedosto.
  STDOUT  Stdout-datan kohdetiedosto.
  HOME    Käyttäjän kotihakemisto. Titokoneessa tätä ei käytetä, vaan
          kotihakemisto kysytään Javan virtuaalikoneen kautta itse
          käyttöjärjestelmältä.
</pre>

<p>
    Oletustiedostot kahdelle ensimmäiselle ovat stdin ja stdout käyttäjän
    työhakemistossa.
</p>

<p>
    Jos yhteenveto Titokoneen käskykannasta ei tyydyttänyt tiedonjanoasi, lisää aiheesta löydät kurssin
    <a href="http://www.cs.helsinki.fi/u/kerola/tito/">Tietokoneen toiminta</a> kotisivuilta.
</p>
<br>

<h2><a name="laajentaminen">5. Järjestelmän hienosäätö ja laajentaminen</a></h2>

<h3><a name="asetustiedostot">5.1 Asetustiedostot</a></h3>

<p>
    Kun käyttäjä muuttaa asetuksia, Titokone tallentaa muutokset tämän
    kotihakemistoon tiedostoon titokone.cfg. Asetustiedosto ylikirjoittuu
    joka asetusmuutoksen jälkeen.
</p>

<p>
    Mikäli Titokone on avattu jar-paketistaan, järjestelmän oletusasetukset
    löytyvät tiedostosta fi/helsinki/cs/titokone/etc/settings.cfg. Tämän tiedoston
    sisältö on seuraavanlainen:
</p>
<pre>
   # Default settings. Running mode: commented (+1), one row at a time (+2),
   # but not animated (+4) compilation mode: commented (+1) but not
   # one happening at a time (+2). Stdin and stdout file paths given are
   # relative to the current working directory. 'Stdout use' describes that
   # the file should be used in append mode ('append') instead of
   # overwriting ('overwrite') it for every new run. Memory size is 2^9 =
   # 512 lines.
   Language = English
   Running mode = 3
   Compilation mode = 1
   Stdin file = stdin
   Stdin path = relative
   Stdout file = stdout
   Stdout path = relative
   Stdout use = append
   Memory size = 9
</pre>
<p>
    Asetustiedoston käsin muuttamiseen ei yleensä ole tarvetta. STDIN- ja
    STDOUT-tiedostojen polut tallentuvat tiedostoon kuitenkin aina ns.
    absoluuttisessa muodossa, kun ne on valittu Titokoneen
    käyttöliittymästä. Mikäli polku halutaan ilmaista suhteessa
    työhakemistoon, näin voidaan tehdä asettamalla kohdan "Stdin path" tai
    "Stdout path" arvoksi 'relative', kuten yllä.
</p>

<p>
    Lisäksi, samoin jar-paketin sisällä fi/helsinki/cs/titokone/etc/-hakemistossa,
    sijaitsee kieliasetustiedosto languages.cfg. Tästä tiedostosta Titokone
    hakee luettelon järjestelmän osiksi lisätyistä kielitiedostoista, jotka
    luetellaan kielenvaihtovalikossa kielen nimen perusteella. Tällaiset
    kielitiedostot on sijoitettu fi/helsinki/cs/titokone/resources/-hakemistoon,
    niiden nimi on muotoa Translations_xx.class ja ne kuuluvat pakettiin
    fi.helsinki.cs.titokone.resources. Kielitiedosto muodostuu pareista muotoa
    "kielen nimi valikossa" = "xx". Arvon "xx" tulee olla kieltä kuvaava
    kaksikirjaiminen tunnus (tämä syötetään java.util.Localen
    konstruktorille). Oletuskielitiedoston sisältö on seuraavanlainen:
</p>
<pre>
   Suomi = fi
   English = en
</pre>


<h3><a name="kielenlisays">5.2 Uuden kielen tukeminen</a></h3>

<p> Uuden kielen lisääminen Titokoneeseen tapahtuu antamalla
    käännösvastineet oletuskielenä toimivan kielen sanoille ja
    fraaseille. Oletuskielenä on englanti. Lisättävää kieltä varten
    kirjoitetaan ohjeiden mukainen Java-tiedosto, joka käännetään ja
    avataan Titokoneen käyttöliittymän kautta. Uuden kielitiedoston
    kirjoittaminen käy helpoiten ottamalla mallia olemassaolevasta
    kielitiedostosta. Avaa koneeltasi ensin tekstieditori, johon haet
    titokone.jar -paketin mukana tulleen tiedoston Translations_fi.java
    -tiedoston hakemistosta fi/helsinki/cs/titokone/resources. Tekstieditoriin
    aukeaa Javan ResourceBundle-kalustoa hyväksikäyttävä luokka, joka
    muodostuu 2-ulotteisesta Object-taulukosta ja sen palauttavasta
    metodista. Taulukon alkiot näyttävät seuraavilta:</p>

<pre>
   { "Fetch second operand from memory slot {0}.", "Nouda jälkimmäinen operandi muistipaikasta {0}."},
   { "Indirect memory addressing mode.", "Epäsuora muistiosoitus."},
   { "1: Fetch indexing value from memory slot {0}.", "1: Nouda indeksointiarvo muistipaikasta {0}."}, 
</pre>
<p>
    Jokainen rivi koostuu aaltosulkujen välissä olevasta oletuskielen avainarvosta ja sen käännösvastineesta.
    Uloimpien aaltosulkujen sisällä on kaksi lainausmerkeillä rajattua tekstikenttää, jotka on erotettu pilkulla
    toisistaan. Ensimmäisten lainausmerkkien sisällä on oletuskielinen käännösavain. Toisten lainausmerkkien sisällä on
    käännösvastine. Oma käännösvastine luodaan korvaamalla suomenkielinen teksti. Yleensä
    lauseen merkitys on jossain määrin pääteltävissä itse
    lauseesta. Käännöksiä helpottamaan Translations_fi -tiedostossa on
    kommenteilla kerrottu, mihin luokkaan kyseiset käännökset
    viittaavat. Jos käännettävän lauseen merkitys tuntuu epäselvältä,
    luokan lähdekoodista on mahdollista selvittää sen konteksti ja
    esimerkiksi käännökseen sijoitettavan muuttujan tarkoitus.
</p>

<p>
    Allaolevan esimerkin käännöksissä esiintyy erikoismerkkijono, '{0}'. Kyseisen merkkijonon tilalle sijoitetaan
    muuttuja, joka liittyy käyttöliittymälle välitettävään viestiin. Esimerkin ensimmäisen rivin {0} sisältää
    muistipaikan numeron. Käännöstä tehdessä on mahdollista luoda uusi käännösvastine, jonka muuttuja
    ei olekaan rivin lopussa, esimerkiksi:
<pre>
//Animator
{ "Fetch second operand from memory slot {0}.", "Nouda jälkimmäinen operandi muistipaikasta {0}."},
-->
//Animator
{ "Fetch second operand from memory slot {0}.", "Muistipaikasta {0} noudetaan jälkimmäinen operandi."},
</pre>
<p> Uusi kielitiedosto luodaan seuraavasti: </p>
<ol>
    <li> Avaa Translations_fi.java.</li>
    <li> Tallenna tiedosto haluamaasi paikkaan haluamallasi nimellä, mutta
        .java-päätteisenä.
    </li>
    <li> Anna käännösvastineet suomenkielisten tekstien kohdalle.</li>
    <li> Sijoita muuttujat {0}...{n} mielekkäille paikoille lauseessa</li>
    <li> Poista tiedostosta rivi 4: 'package fi.helsinki.cs.titokone.resources;'.</li>
    <li> Vaihda luokan nimi vastaamaan antamaasi tiedoston nimeä.</li>
    <li> Käännä tiedosto esimerkiksi javac-komennolla</li>
    <li> Käynnistä Titokone</li>
    <li><a href="#kielenvaihto">Vaihda kielitiedosto</a></li>
</ol>
<p>
    Voit myös lisätä uuden kielen pysyväksi osaksi järjestelmää, jolloin
    käännöstiedostoa ei enää tarvitse etsiä joka kerta uudelleen. Tallenna
    kohdassa 2 tiedosto hakemistoon fi/helsinki/cs/titokone/resources/ muiden
    käännöstiedostojen kanssa. Muuta luokan nimeksi rivillä
</p>
<pre>
public class Translations_fi {
</pre>
<p>käännöskielesi ('xx') mukaan Translations_xx ja tallenna se tiedostoon Translations_xx.java. Korvaa
    'xx' kohdekielesi ISO-koodilla (Javan Localen tukemat versiot ISO 639:stä). Esimerkiksi jos kääntäisit ohjelman
    norjaksi, koodi olisi 'no', saksan vastaava olisi 'de'. <b>Älä poista tiedostosta (kohdan 4
        mukaan) pakettimääreriviä</b>, sillä nyt sitä tarvitaan.
</p>

<p>
    Kun käännöksesi on valmis ja sille on käännetty .class-tiedosto, asenna
    se lisäämällä kieliasetustiedostoon fi/helsinki/cs/titokone/etc/languages.cfg
    rivi "kielen nimi valikossa" = "xx", jossa korvaat taas xx:n
    kielikoodillasi. Esimerkiksi "Deutsch = de". Ks. myös <a
        href="#asetustiedostot">5.1, asetustiedostot</a>.
    Kun nyt käynnistät Titokoneen seuraavan kerran, uusi kieli on yhtenä
    vaihtoehtona valikossa.
</p>

<br>

<h2><a name="pulmanpoisto">6. Virhetilanteita</a></h2>

<ol>
    <li><a href="#saie">Terminaali-ikkunaan tuleee eriskummallisia virheilmoituksia</a></li>
    <li><a href="#stdinvirhe">STDIN-tiedostoa ei voi lukea, mutten kyllä
        yrittänytkään</a></li>
    <li><a href="#kaannoskaks">Kääntäjä ei korosta virheellistä riviä</a></li>
    <li><a href="#itsekoodi"> Itseään muuttava koodi ei toimi? </a></li>
    <li><a href="#valittu">Miten pääsen muuttamaan koodia epäonnistuneen
        käännöksen jälkeen?</a></li>
    <li><a href="#paranoidi"> Lähdekooditiedosto kirjoittui yli?</a></li>
    <li><a href="#muuttuja"> Miten niin epäkelpo komento equ?</a></li>
    <li><a href="#animointi">Animointi ja rivittäin suoritus -outous</a></li>
    <li><a href="#spfp"> Animaattorin SP ja FP, missä ne ovat?</a></li>
    <li><a href="#R0"> Rekisteristä R0 tulee pelkkää nollaa </a></li>
    <li><a href="#apua"> Ei mikään näistä ongelmista...</a></li>
</ol>

<br>
<a name="saie"><b>Näen ikkunassa, josta käynnistin Titokoneen, outoja Javan
    virheilmoituksia. Sovellus ei kuitenkaan vaikuta kaatuneen. Mistä on kyse?</b></a>

<div>
    Vastaus: Ongelmat johtuvat pääasiassa kuun väärästä asennosta. Eräänä osasyynä saattavat olla
    samanaikaisuusongelmat, joilta olisimme voineet kenties välttyä jos
    olisimme kuunnelleet tarkemmin Rinnakkaisohjelmistot-kurssilla; osan
    taas aiheuttavat Javan grafiikkakirjasto Swingin viat, joita emme pääse
    korjaamaan. Pahoittelumme, jättäkää satunnaiset virheilmoitukset tällä erää
    vain huomiotta.
</div>

<br>
<a name="stdinvirhe"><b>Saan virheilmoituksen siitä, ettei
    STDIN-tiedostoa voida lukea, vaikka lataamani ohjelma ei edes yritä
    lukea sitä. Missä vika?</b></a>

<div>
    Vastaus: Ohjelma ilmoittaa vain, että mikäli tulevaisuudessa näillä asetuksilla joku
    TTK-91-sovellus yrittää lukea STDIN-laitteelta, luku epäonnistuu ellei jotain tehdä
    asialle. Virheilmoituksen jälkeen näytetään järjestelmän antama
    virheilmoitus tiedostoa luettaessa. Jos sovelluksesi tarvitsee
    STDIN-laitetta, korjaa tiedoston tilanne ja lataa sovellus
    uudelleen. Katso myös <a href="#lataaminen">3.5, TTK-91-ohjelman
    lataaminen</a>.
</div>

<br>
<a name="kaannoskaks"><b>Ohjelmaani oli jäänyt virheellinen rivi
    koodia; yritin käyttää määrittelemätöntä muuttujaa. Virheilmoitus tuli kyllä ruudulle,
    mutta rivi ei korostu. Mitä ihmettä?</b></a>

<div>Vastaus: käännöksen toisessa vaiheessa, objektikoodin luonnissa olevaa virheellistä riviä
    ei korosteta, jos virhe sattuu olemaan objektikoodin ensimmäisellä
    rivillä. Pahoittelemme bugia.
</div>

<br>
<a name="itsekoodi"><b>Tein valtavan hienon ohjelman, joka sisältää itseään muuttavaa
    koodia. Ensimmäisen kerran ajettuani ohjelman, muuttunut koodi jäi koodialueelle. Eihän oikeat
    koneet niin toimi?</b></a>

<div> Valitettavasti Titokoneen versiossa 1.0 on bugi, jonka takia
    koodialuetta ei piirretä uudelleen uudelleenlatauksen yhteydessä. Itseään
    muuttanut koodi näkyy tästä syystä väärin, vaikka se on koneen
    sisäisesti ladattu uudelleen oikein.
</div>


<br>
<a name="valittu"><b>Käännös päättyi virheeseen ensimmäisellä kierroksella, mutta en pääse
    muokkaamaan koodia! Virheen aiheuttanut rivi pysyy valittuna.</b></a>

<div>Virheen jälkeen Titokone näyttää vielä virheeseen johtaneen
    lopputilanteen. Kun painat jatka-nappia tai rivinvaihtonäppäintä, käännöksestä siirrytään takaisin
    lähdekoodinäkymään, jossa voit muokata koodia.
</div>
<br>
<a name="paranoidi"><b> Avasin useita lähdekooditiedostoja Titokoneessa, muokkasin niistä
    paria ja nyt joku tiedostoista kirjoittui toisen päälle! Olenko
    paranoidi?
</b></a>

<div> Et ole, vaan erittäin ikävä bugi, jota emme Titokoneen versiosta 1.0
    saaneet paikannettua, aiheuttaa joskus tällaisen ylikirjoittumisen.
    Ongelman voi välttää muokkaamalla tiedostoja muualla (suuremmat
    muokkaukset tulisi joka tapauksessa tehdä toisaalla) tai käsittelemällä
    Titokoneella vain yhtä tiedostoa kerrallaan. Pahoittelemme kovasti.
    Laskuharjoitusten pitäjälle voi näyttää tämän osan käyttöohjeesta,
    mikäli hän ei ota uskoakseen "Titokone söi kotitehtäväni!" -selitystäsi.
    (Tämä selitys todennäköisesti toimii vain kerran.)
</div>


<br>

<a name="muuttuja"><b>Saan käännösvirheen "epäkelpo komento dc" (tai ds tai equ), kun käytän
    nähdäkseni ihan oikein muotoa "muuttuja dc 333333333333333" </b></a>

<div>Kun jälkimmäinen luku on riittävän pitkä, kääntäjä ei näe siinä
    kelvollista dc-komentoa (suurin mahdollinen luku DC:lle on 2^31-1, eli
    2147483647), vaan yrittää tulkita komentoa muodossa "muistiviite komento
    parametrit", mistä outo virheilmoitus johtuu. Virheilmoituksen
    selventäminen on parannuslistalla Titokoneen seuraavaa versiota varten.
</div>

<br><a name="animointi"><b> Kun klikkaan animointiasetuksen päälle, rivittäin suoritus menee
    samalla myös päälle. En saa riveittäin suoritusta pois päältä ilman,
    että animointikin lakkaa. Missä on vika?</b></a>

<div>Animoinnin seuraamisen helpottamiseksi ja synkronointiongelmia
    vähentääksemme päätimme, että animointi tehdään rivi kerrallaan. Tästä
    syystä riveittäin suorituksen asetus vaaditaan aina asetetuksi yhdessä
    animoinnin kanssa.
</div>

<br>

<b><a name="R0">Rekisteri R0 ei toimi? Latasin luvun 14 rekisteriin R0, nyt yritän
    saada sen sieltä pois, mutta sieltä tulee vaan nollaa. Johtuuko tämä kahden komplementista?
</a></b>

<div>Johtuen TTK-91 määrittelyistä, rekisterille R0 on varattu
    erikoismerkitys; kun se on toisena parametrinä, sieltä
    palautetaan aina arvo 0, vaikka sisältö olisi eri. Pahoittelemme mahdollista sekaannusta.
</div>
<br>
<a name="spfp"><b>Animointi-ikkunassa ei ole SP:tä eikä FP:tä!</b></a>

<div>SP:n toinen nimi on R6 ja FP:n R7. Ne ovat animointi-ikkunassa tällä
    nimellä; tosin tämä voidaan muuttaa käännöstiedostoista tarvittaessa.
</div>
<br>
<b><a name="apua">Parannusehdotuksia, ongelmia?</a></b>

<div>Mikäli kohtaamasi virhetilanne ei löytynyt tästä, ole hyvä ja ilmoita
    siitä esimerkiksi jollekin Tietokoneen toiminta -kurssin luennoijalle ja
    pyydä välittämään viesti eteenpäin. Bugiraportteja otetaan myös vastaan.
</div>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>


</body>
</html>
